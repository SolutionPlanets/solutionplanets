---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Timeline from '~/components/ui/Timeline.astro';
import Headline from '~/components/ui/Headline.astro';
//import Image from '~/components/common/Image.astro';
import type { Steps as Props } from '~/types';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  items = [],
  image = await Astro.slots.render('image'),
  isReversed = false,

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-5xl ${classes?.container ?? ''}`} bg={bg}>
  <div class:list={['flex flex-col gap-8 md:gap-12', { 'md:flex-row-reverse': isReversed }, { 'md:flex-row': image }]}>
    <div class:list={['md:py-4 md:self-center', { 'md:basis-1/2': image }, { 'w-full': !image }]}>
      <Headline
        title={title}
        subtitle={subtitle}
        tagline={tagline}
        classes={{
          container: 'text-left rtl:text-right',
          title: 'text-3xl lg:text-4xl',
          ...((classes?.headline as object) ?? {}),
        }}
      />
      <Timeline items={items} classes={classes?.items as Record<string, never>} />
    </div>
    {
      image && (
        <div class="relative md:basis-1/2">
          <div class="deployment-animation">
            <svg viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg">
              <!-- Background gradient -->
              <defs>
                <radialGradient id="spaceGradient" cx="50%" cy="50%">
                  <stop offset="0%" style="stop-color:#0160ef;stop-opacity:0.2" />
                  <stop offset="100%" style="stop-color:#6d28d9;stop-opacity:0" />
                </radialGradient>
                
                <linearGradient id="planetGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#0160ef" />
                  <stop offset="100%" style="stop-color:#6d28d9" />
                </linearGradient>

                <filter id="glow">
                  <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                  <feMerge>
                    <feMergeNode in="coloredBlur"/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>

              <!-- Background -->
              <rect width="400" height="600" fill="url(#spaceGradient)"/>

              <!-- Stars -->
              <circle class="star star-1" cx="50" cy="80" r="1.5" fill="white" opacity="0.8"/>
              <circle class="star star-2" cx="350" cy="150" r="1" fill="white" opacity="0.6"/>
              <circle class="star star-3" cx="100" cy="250" r="1.2" fill="white" opacity="0.7"/>
              <circle class="star star-4" cx="300" cy="400" r="1" fill="white" opacity="0.8"/>
              <circle class="star star-5" cx="150" cy="500" r="1.3" fill="white" opacity="0.6"/>

              <!-- Central Planet (Solution Planets) -->
              <g class="planet-orbit">
                <circle cx="200" cy="300" r="60" fill="url(#planetGradient)" filter="url(#glow)"/>
                <circle cx="200" cy="300" r="55" fill="none" stroke="#8a2be2" stroke-width="2" opacity="0.3"/>
              </g>

              <!-- Orbiting nodes (representing steps) -->
              <g class="orbit-path">
                <circle cx="200" cy="300" r="120" fill="none" stroke="#0160ef" stroke-width="1" opacity="0.3" stroke-dasharray="5,5"/>
              </g>

              <!-- Step 1: Architect (top) -->
              <g class="step-node step-1">
                <circle cx="200" cy="180" r="20" fill="#0160ef" filter="url(#glow)"/>
                <path d="M 195 175 L 200 170 L 205 175 L 205 185 L 195 185 Z" fill="white"/>
              </g>

              <!-- Step 2: Integrate (right) -->
              <g class="step-node step-2">
                <circle cx="304" cy="300" r="20" fill="#6d28d9" filter="url(#glow)"/>
                <rect x="297" y="293" width="14" height="14" fill="white" rx="2"/>
              </g>

              <!-- Step 3: Calibrate (bottom) -->
              <g class="step-node step-3">
                <circle cx="200" cy="420" r="20" fill="#8a2be2" filter="url(#glow)"/>
                <circle cx="200" cy="420" r="7" fill="none" stroke="white" stroke-width="2"/>
                <circle cx="200" cy="420" r="3" fill="white"/>
              </g>

              <!-- Step 4: Deploy (left) -->
              <g class="step-node step-4">
                <circle cx="96" cy="300" r="20" fill="#4169e1" filter="url(#glow)"/>
                <path d="M 89 300 L 103 295 L 103 305 Z" fill="white"/>
              </g>

              <!-- Connection lines (animated) -->
              <g class="connection-lines">
                <line class="conn-line line-1" x1="200" y1="240" x2="200" y2="180" stroke="#0160ef" stroke-width="2" opacity="0"/>
                <line class="conn-line line-2" x1="260" y1="300" x2="304" y2="300" stroke="#6d28d9" stroke-width="2" opacity="0"/>
                <line class="conn-line line-3" x1="200" y1="360" x2="200" y2="420" stroke="#8a2be2" stroke-width="2" opacity="0"/>
                <line class="conn-line line-4" x1="140" y1="300" x2="96" y2="300" stroke="#4169e1" stroke-width="2" opacity="0"/>
              </g>

              <!-- Data particles flowing -->
              <circle class="particle particle-1" cx="200" cy="240" r="3" fill="#0160ef"/>
              <circle class="particle particle-2" cx="260" cy="300" r="3" fill="#6d28d9"/>
              <circle class="particle particle-3" cx="200" cy="360" r="3" fill="#8a2be2"/>
              <circle class="particle particle-4" cx="140" cy="300" r="3" fill="#4169e1"/>
            </svg>
          </div>
        </div>
      )
    }
  </div>
</WidgetWrapper>

<style>
  .deployment-animation {
    width: 100%;
    height: 100%;
    min-height: 600px;
    border-radius: 0.5rem;
    overflow: hidden;
    background: linear-gradient(135deg, rgba(1, 96, 239, 0.1), rgba(109, 40, 217, 0.1));
  }

  /* Star twinkling */
  @keyframes twinkle {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.5); }
  }

  .star-1 { animation: twinkle 3s ease-in-out infinite; }
  .star-2 { animation: twinkle 4s ease-in-out infinite 0.5s; }
  .star-3 { animation: twinkle 3.5s ease-in-out infinite 1s; }
  .star-4 { animation: twinkle 4.5s ease-in-out infinite 1.5s; }
  .star-5 { animation: twinkle 3.8s ease-in-out infinite 2s; }

  /* Planet pulse */
  @keyframes planetPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .planet-orbit {
    animation: planetPulse 4s ease-in-out infinite;
    transform-origin: 200px 300px;
  }

  /* Orbit rotation */
  @keyframes orbitRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .orbit-path {
    animation: orbitRotate 20s linear infinite;
    transform-origin: 200px 300px;
  }

  /* Step nodes floating */
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
  }

  .step-1 { animation: float 3s ease-in-out infinite; }
  .step-2 { animation: float 3s ease-in-out infinite 0.75s; }
  .step-3 { animation: float 3s ease-in-out infinite 1.5s; }
  .step-4 { animation: float 3s ease-in-out infinite 2.25s; }

  /* Connection lines appearing */
  @keyframes lineAppear {
    0%, 20% { opacity: 0; stroke-dashoffset: 100; }
    40%, 80% { opacity: 1; stroke-dashoffset: 0; }
    100% { opacity: 0; }
  }

  .conn-line {
    stroke-dasharray: 100;
    animation: lineAppear 8s ease-in-out infinite;
  }

  .line-1 { animation-delay: 0s; }
  .line-2 { animation-delay: 2s; }
  .line-3 { animation-delay: 4s; }
  .line-4 { animation-delay: 6s; }

  /* Particles flowing along connections */
  @keyframes flowParticle1 {
    0% { cx: 200; cy: 240; opacity: 0; }
    20% { opacity: 1; }
    50% { cx: 200; cy: 180; opacity: 1; }
    70% { opacity: 0; }
    100% { cx: 200; cy: 240; opacity: 0; }
  }

  @keyframes flowParticle2 {
    0% { cx: 260; cy: 300; opacity: 0; }
    20% { opacity: 1; }
    50% { cx: 304; cy: 300; opacity: 1; }
    70% { opacity: 0; }
    100% { cx: 260; cy: 300; opacity: 0; }
  }

  @keyframes flowParticle3 {
    0% { cx: 200; cy: 360; opacity: 0; }
    20% { opacity: 1; }
    50% { cx: 200; cy: 420; opacity: 1; }
    70% { opacity: 0; }
    100% { cx: 200; cy: 360; opacity: 0; }
  }

  @keyframes flowParticle4 {
    0% { cx: 140; cy: 300; opacity: 0; }
    20% { opacity: 1; }
    50% { cx: 96; cy: 300; opacity: 1; }
    70% { opacity: 0; }
    100% { cx: 140; cy: 300; opacity: 0; }
  }

  .particle-1 { animation: flowParticle1 8s ease-in-out infinite; }
  .particle-2 { animation: flowParticle2 8s ease-in-out infinite 2s; }
  .particle-3 { animation: flowParticle3 8s ease-in-out infinite 4s; }
  .particle-4 { animation: flowParticle4 8s ease-in-out infinite 6s; }
</style>
